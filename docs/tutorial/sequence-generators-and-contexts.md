# Generadores de secuencias & contextos

Ahora tenemos que poner las cosas en contexto. Todo en Mégra se ejecuta dentro de un contexto donde se sincronizan diferentes secuencias (o generadores de secuencias).
Es por eso que es un "Sync-conteXt" o "sx" para abreviar. "Sincronización" aquí se refiere a que los generadores se inician al mismo tiempo.
Si corren a diferentes velocidades (más sobre eso más adelante), no permanecerán sincronizados.

Un contexto de sincronización necesita un **nombre** y una **bandera** que le indique si debe ejecutarse o no.

Todo lo que sigue son **generadores de secuencia**. Un **generador de secuencias** genera una secuencia de eventos de sonido (o control), de ahí el nombre.

```lisp
;; This is a comment ... everything behind ;; will be ignored.

;; This is a sync context. It catches the sound events generated by the sequence generators.
;; Names in Mégra start with a ' , so the name here is just 'context. This is inherited from 
;; Lisp family of programming languages.
;; The flag (boolean) is either #t (true) or #f (false) and determines whether the context 
;; active or not.

(sx 'context #t ;; <-- sx <name> <flag>
  (cyc 'cycle-generator "bd ~ hats ~ sn ~ hats ~")) ;; <-- this generates a sequence of event
```

You can put multiple sequence generators in the same context, so that they all run in sync:
Per defualt, new generators (that were not present in the context before) are **syncronized**
on a **non-silent event**.

```lisp
(sx 'context #t ;; <-- set this to #f to mute this context !
  (cyc 'percussion-generator "~ ~ ~ risset:'a5 ~ ~ risset:'c6 ~")
  (cyc 'bassline-generator "saw:'a1 ~ saw:'ds2 saw:'e2 ~ ~ saw:'c3 ~")
  (cyc 'beat-generator "bd ~ hats ~ sn ~ hats ~")) 
```

You can also synchronize multiple contexts:

```lisp
(sx 'context-a #t ;; <-- execute this first
  (cyc 'percussion-generator "~ ~ ~ risset:'a5 ~ ~ risset:'c6 ~")
  (cyc 'beat-generator "bd ~ hats ~ sn ~ hats ~"))

(sx 'context-b #t :sync 'context-a ;; <-- execute this when you deem fit 
  (cyc 'bassline-generator "saw:'a1 ~ saw:'ds2 saw:'e2 ~ ~ saw:'c3 ~"))

(clear) ;; clear stops everything
```

There's more cool stuff you can do with the sync context alone, such as 
**soloing** and **blocking**:

```lisp
(sx 'context #t :solo 'beat-generator ;; <-- You can solo single generators ...
  (cyc 'percussion-generator "~ ~ ~ risset:'a5 ~ ~ risset:'c6 ~")
  (cyc 'bassline-generator "saw:'a1 ~ saw:'ds2 saw:'e2 ~ ~ saw:'c3 ~")
  (cyc 'beat-generator "bd ~ hats ~ sn ~ hats ~"))

(sx 'context #t :block 'beat-generator ;; <-- ... or block them!
  (cyc 'percussion-generator "~ ~ ~ risset:'a5 ~ ~ risset:'c6 ~")
  (cyc 'bassline-generator "saw:'a1 ~ saw:'ds2 saw:'e2 ~ ~ saw:'c3 ~")
  (cyc 'beat-generator "bd ~ hats ~ sn ~ hats ~"))

(sx 'context #t :block 'sn ;; <-- You can also block or solo a special event types.
  (cyc 'percussion-generator "~ ~ ~ risset:'a5 ~ ~ risset:'c6 ~")
  (cyc 'bassline-generator "saw:'a1 ~ saw:'ds2 saw:'e2 ~ ~ saw:'c3 ~")
  (cyc 'beat-generator "bd ~ hats ~ sn ~ hats ~"))

(sx 'context #t :solo 'sn 'risset ;; <-- You can also block or solo multiple tags.
  (cyc 'percussion-generator "~ ~ ~ risset:'a5 ~ ~ risset:'c6 ~")
  (cyc 'bassline-generator "saw:'a1 ~ saw:'ds2 saw:'e2 ~ ~ saw:'c3 ~")
  (cyc 'beat-generator "bd ~ hats ~ sn ~ hats ~"))

(clear)
```

**TECH BACKGROUND:**

You can also think of the sync context as a sink for sound events. Every sound event
that is emitted by the generator has a bunch of tags, which contain the name of the 
generator, the event type, and, in case of sample events, the search tags (more about that later). 
The block and solo keywords activate filters that act on these tags.
